
<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<title>360</title>
	<link rel="stylesheet" href="css/street.css" type="text/css">
</head>
<body>
<div id="main" style="height: 2500px;">
    <div class="header">
        <h1>Scroll Tutorial - #1</h1>
    </div>
       <div class="street-view">
        <video autobuffer poster="shared/street/vid-0001.jpg">
            <source src="shared/street.mp4" type="video/mp4">
            <source src="shared/street.webm" type="video/webm">
        </video>
    </div>
       <div class="hotspot" style="top:100px; left: 130px;">
        #1
    </div>
       <div class="hotspot" style="top: 800px; right: 130px;">
    #2
    </div>
       <div class="hotspot" style="top: 1000px; left: 130px;">
        #3
    </div>
       <div class="hotspot" style="top: 1500px; left: 130px;">
        #4
    </div>
       <div class="hotspot" style="top: 2100px; right: 130px;">
        #5
    </div>
</div>

<script src="shared/js/jquery-1.6.js"></script>

	<script>
	
		$(document).ready(function(){
			var $doc = $(document);
			var $win = $(window);

			// dimensions - we want to cache them on window resize
			var windowHeight, windowWidth;
			var fullHeight, scrollHeight;
			var streetImgWidth = 1024, streetImgHeight = 640;
			calculateDimensions();

			var currentPosition = 0;
			var $videoContainer = $('.street-view');
			var video = $('.street-view > video')[0];


			// handling resize and scroll events
			
			function calculateDimensions() {
				windowWidth = $win.width();
				windowHeight = $win.height();
				fullHeight = $('#main').height();
				scrollHeight = fullHeight - windowHeight;
			}
			
			function handleResize() {
				calculateDimensions();
				resizeBackgroundImage();
				handleScroll();
			}
			
			function handleScroll() {
				currentPosition = $win.scrollTop() / scrollHeight;
				render( currentPosition );
			}




			// rendering


			function render( position ) {
				renderVideo( position );
			}


			function renderVideo(position) {
				if ( video.duration ) {
					video.currentTime = position * video.duration;
				}
			}

			function resizeBackgroundImage(){
				// get image container size
				var scale = Math.max( windowHeight/streetImgHeight , windowWidth/streetImgWidth );
				var width = scale * streetImgWidth , height = scale * streetImgHeight;
				var left = (windowWidth-width)/2, top = (windowHeight-height)/2;
				$videoContainer
						  .width(width).height(height)
						  .css('position','fixed')
						  .css('left',left+'px')
						  .css('top',top+'px');
			}


			// setting up scroll and resize listeners

			$win.resize( handleResize );
			$win.scroll( handleScroll );

			handleResize();


		});


	</script>


</body>
</html>